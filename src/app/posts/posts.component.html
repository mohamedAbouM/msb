

<div class="row mt-4">
  <div class="col-md-6">    
    <h1> List of Posts</h1>
  </div>
  <div class="col-md-6 text-right">  
    <button (click)="displayForm()" class ="btn btn-light bt-sm">
      <i class="fa fa-plus"></i>
    </button>  
</div>
</div>
<div class ="row">
    <div class="col-md-12 my-4">
      <app-search my-title="Search posts" (searchItemEvent)="searchPost($event)"></app-search>
    </div>
 </div>

<div class="row" *ngIf="display">
  <div class="col-md-6 mx-auto"> 
    <form #f="ngForm">
    <div class="form-group">
      <label for="title">Tilte</label>
      <input 
        required minlength="3"
        pattern="[a-zA-Z0-9 ]*"
        (change)="info(title)"
        name="title"
        #title="ngModel"
        id="title" 
        type="text" 
        class="form-control" 
        [(ngModel)]="post.title">
        <div class="alert alert-danger my-1" *ngIf="title.touched && title.invalid">          
          <div *ngIf="title.errors.required">this field is required !</div>
          <div *ngIf="title.errors.minlength">This field should be great than {{title.errors.minlength.actualLength}}/{{title.errors.minlength.requiredLength}} characters</div>
          <div *ngIf="title.errors.pattern"> this field is not respect the pattern</div>
        </div>
    </div>
    <div class="formgroup">
      <label for="body"> body</label>
      <textarea
        required minlength="10"
        #body="ngModel"
        name="body"   
        id="body" 
        cols="30" rows="3" 
        class="form-control"  
        [(ngModel)]="post.body">
      </textarea>
      <div class="alert alert-danger my-1" *ngIf="body.touched && body.invalid"> 
        <div *ngIf="body.errors.required">this field is required !</div>
        <div *ngIf="body.errors.minlength">This field should be great than {{body.errors.minlength.actualLength}}/{{body.errors.minlength.requiredLength}} characters</div>
      </div>
    </div>
    <!-- <div *ngIf="title.valid && body.valid"> -->
      <button *ngIf="!editable" class="btn btn-primary my-2 btn-block" (click)="persistePost(f)"><i class="fa fa-send"></i> save</button>
      <button *ngIf="editable" class="btn btn-warning my-2 btn-block" (click)="updatePoste()"><i class="fa fa-refresh"></i> update</button>
    <!-- </div> -->
    </form>   
  </div>
</div>


<table class="table table-hover">
  <thead>
    <tr>
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>Vote</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr  *ngFor="let post of postsresult; index as i" >
      <td><button class="btn btn-sm " (click)="updateStatus(post)"><i  class="fa fa-power-off" [ngClass]="{
        'text-danger':!post.active,
        'text-success':post.active
      }"></i></button></td>
      <td>{{post.title}}</td>
      <td>{{post.body}}</td> 
      <td>
        like:{{post.vote?.like}} -dislike : {{post.vote?.dislike}}
        <app-votes 
          [like]="post.vote?.like" 
          [dislike]="post.vote?.dislike" 
          (voteEmitter)="incVote($event,post)"></app-votes>
      </td>
      <td>   
        <button class="btn btn-warning btn-sm mr-1" (click)="editPost(post)"><i class="fa fa-pencil"></i></button>
       <button class="btn btn-dark btn-sm " (click)="deletePost(post.id)"><i class="fa fa-trash"></i></button>
      </td>  
    </tr>
  </tbody>
</table>
